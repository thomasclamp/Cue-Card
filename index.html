<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cue Cards</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Shadows+Into+Light&display=swap" rel="stylesheet">
    <style>
        :root {
            --card-cream: #FAF4E8;
            --card-edge: #E8DCC4;
            --text-ink: #2C2416;
            --accent-red: #C84B31;
            --shadow-soft: rgba(44, 36, 22, 0.15);
            --bg-desk: #8B7355;
            --bg-wood: #5D4E37;
            --line-blue: #4A90E2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', monospace;
            background: linear-gradient(135deg, var(--bg-desk) 0%, var(--bg-wood) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(0,0,0,0.03) 2px,
                    rgba(0,0,0,0.03) 4px
                );
            pointer-events: none;
            z-index: 1;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 900px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease-out;
        }

        .header h1 {
            font-family: 'Shadows Into Light', cursive;
            font-size: 3.5rem;
            color: var(--card-cream);
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .header p {
            color: var(--card-cream);
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        .btn {
            background: var(--card-cream);
            border: none;
            padding: 12px 24px;
            font-family: 'Courier Prime', monospace;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-ink);
            cursor: pointer;
            border-radius: 4px;
            box-shadow: 
                0 4px 8px var(--shadow-soft),
                inset 0 -2px 0 rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 12px var(--shadow-soft),
                inset 0 -2px 0 rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 4px var(--shadow-soft),
                inset 0 -1px 0 rgba(0,0,0,0.1);
        }

        .btn.btn-add {
            background: var(--accent-red);
            color: white;
        }

        .card-stack {
            perspective: 1000px;
            position: relative;
            min-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card {
            position: absolute;
            width: 100%;
            max-width: 600px;
            background: var(--card-cream);
            border-radius: 2px;
            padding: 40px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.5);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            border: 1px solid var(--card-edge);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 40px;
            right: 40px;
            height: 100%;
            background: repeating-linear-gradient(
                transparent,
                transparent 29px,
                var(--line-blue) 29px,
                var(--line-blue) 30px
            );
            opacity: 0.15;
            pointer-events: none;
        }

        .card.active {
            z-index: 10;
            transform: translateY(0) rotateX(0deg) scale(1);
        }

        .card.stacked-1 {
            z-index: 9;
            transform: translateY(-8px) rotateX(-2deg) scale(0.95);
            opacity: 0.8;
        }

        .card.stacked-2 {
            z-index: 8;
            transform: translateY(-16px) rotateX(-4deg) scale(0.9);
            opacity: 0.6;
        }

        .card.hidden {
            opacity: 0;
            transform: translateY(-30px) rotateX(-10deg) scale(0.8);
            pointer-events: none;
        }

        .card-content {
            position: relative;
            z-index: 1;
        }

        .card-front, .card-back {
            min-height: 250px;
        }

        .card-front textarea, .card-back textarea {
            width: 100%;
            min-height: 250px;
            background: transparent;
            border: none;
            font-family: 'Courier Prime', monospace;
            font-size: 1.3rem;
            color: var(--text-ink);
            resize: vertical;
            outline: none;
            line-height: 1.8;
        }

        .card-front textarea::placeholder,
        .card-back textarea::placeholder {
            color: rgba(44, 36, 22, 0.4);
            font-style: italic;
        }

        .card-display {
            font-size: 1.3rem;
            color: var(--text-ink);
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-red);
        }

        .card-number {
            font-family: 'Shadows Into Light', cursive;
            font-size: 1.5rem;
            color: var(--accent-red);
            font-weight: 700;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .card-btn {
            background: transparent;
            border: none;
            color: var(--text-ink);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px 10px;
            transition: all 0.2s ease;
            opacity: 0.6;
        }

        .card-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .flip-indicator {
            text-align: center;
            margin-top: 20px;
            font-family: 'Shadows Into Light', cursive;
            color: var(--text-ink);
            opacity: 0.5;
            font-size: 1rem;
        }

        .progress {
            text-align: center;
            margin-top: 30px;
            font-size: 1.1rem;
            color: var(--card-cream);
            font-weight: 700;
            animation: fadeIn 1s ease-out 0.4s both;
        }

        .empty-state {
            text-align: center;
            color: var(--card-cream);
            font-size: 1.3rem;
            padding: 60px 20px;
            animation: fadeIn 0.6s ease-out;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-cream);
            border-radius: 4px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-header {
            font-family: 'Shadows Into Light', cursive;
            font-size: 2rem;
            color: var(--accent-red);
            margin-bottom: 25px;
            text-align: center;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-body label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text-ink);
        }

        .modal-body textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            font-family: 'Courier Prime', monospace;
            font-size: 1.1rem;
            border: 2px solid var(--card-edge);
            border-radius: 4px;
            resize: vertical;
            margin-bottom: 20px;
            background: white;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }

            .card {
                padding: 30px;
            }

            .card-front textarea, .card-back textarea,
            .card-display {
                font-size: 1.1rem;
            }

            .modal-content {
                padding: 30px 20px;
            }
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            line-height: 1.6;
            animation: slideUp 0.3s ease-out;
        }

        .chat-message.ai {
            background: #F0F4F8;
            border-left: 4px solid #6B5B95;
            margin-right: 20px;
        }

        .chat-message.user {
            background: #E8F5E9;
            border-left: 4px solid var(--accent-red);
            margin-left: 20px;
        }

        .chat-message-label {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-ink);
            opacity: 0.7;
        }

        .chat-message-text {
            color: var(--text-ink);
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '.';
            animation: dots 1.5s steps(3, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cue Cards</h1>
            <p>Study smarter, not harder</p>
        </div>

        <div class="controls">
            <button class="btn btn-add" onclick="openAddModal()">+ Add Card</button>
            <button class="btn" onclick="shuffleCards()">üîÄ Shuffle</button>
            <button class="btn" onclick="resetDeck()">‚Ü∫ Reset</button>
            <button class="btn" onclick="openAIQuizModal()" style="background: #6B5B95; color: white;">ü§ñ AI Quiz Me</button>
        </div>

        <div id="cardStack" class="card-stack"></div>

        <div id="progress" class="progress"></div>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Create New Card</div>
            <div class="modal-body">
                <label for="frontInput">Front (Question/Prompt)</label>
                <textarea id="frontInput" placeholder="Enter your question or prompt..."></textarea>
                
                <label for="backInput">Back (Answer)</label>
                <textarea id="backInput" placeholder="Enter the answer..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeAddModal()">Cancel</button>
                <button class="btn btn-add" onclick="addCard()">Add Card</button>
            </div>
        </div>
    </div>

    <div id="aiQuizModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">AI Study Session</div>
            <div class="modal-body">
                <div id="aiQuizContent">
                    <div style="text-align: center; padding: 20px;">
                        <p style="margin-bottom: 20px; font-size: 1.1rem;">
                            I'll quiz you based on your cue cards! I can ask questions in different ways, 
                            test your understanding, and give you feedback.
                        </p>
                        <button class="btn btn-add" onclick="startAIQuiz()">Start Quiz</button>
                    </div>
                </div>
                <div id="aiConversation" style="display: none;">
                    <div id="chatHistory" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; padding: 15px; background: white; border-radius: 4px; border: 2px solid var(--card-edge);"></div>
                    <div style="display: flex; gap: 10px;">
                        <textarea id="userAnswer" placeholder="Type your answer here..." style="flex: 1; min-height: 80px; padding: 12px; font-family: 'Courier Prime', monospace; font-size: 1rem; border: 2px solid var(--card-edge); border-radius: 4px; resize: vertical;"></textarea>
                        <button class="btn btn-add" onclick="submitAnswer()" style="height: fit-content;">Send</button>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn" onclick="getNewQuestion()">Skip / New Question</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeAIQuizModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        let cards = [
            { front: "What is the capital of France?", back: "Paris" },
            { front: "Who wrote 'Romeo and Juliet'?", back: "William Shakespeare" },
            { front: "What is the speed of light?", back: "299,792,458 meters per second" }
        ];
        let currentIndex = 0;
        let flippedCards = new Set();

        function render() {
            const cardStack = document.getElementById('cardStack');
            const progress = document.getElementById('progress');

            if (cards.length === 0) {
                cardStack.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìá</div>
                        <div>No cards yet. Add some to get started!</div>
                    </div>
                `;
                progress.textContent = '';
                return;
            }

            cardStack.innerHTML = '';

            // Render cards in stack (only show current and next 2)
            for (let i = 0; i < Math.min(3, cards.length - currentIndex); i++) {
                const index = currentIndex + i;
                const card = cards[index];
                const cardEl = document.createElement('div');
                const isFlipped = flippedCards.has(index);
                
                let className = 'card';
                if (i === 0) className += ' active';
                else if (i === 1) className += ' stacked-1';
                else if (i === 2) className += ' stacked-2';

                cardEl.className = className;
                cardEl.innerHTML = `
                    <div class="card-content">
                        <div class="card-header">
                            <div class="card-number">Card ${index + 1}/${cards.length}</div>
                            <div class="card-actions">
                                <button class="card-btn" onclick="editCard(${index})" title="Edit">‚úèÔ∏è</button>
                                <button class="card-btn" onclick="deleteCard(${index})" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="card-display">
                            ${isFlipped ? card.back : card.front}
                        </div>
                        ${i === 0 ? '<div class="flip-indicator">üëÜ Click to flip</div>' : ''}
                    </div>
                `;

                if (i === 0) {
                    cardEl.onclick = () => flipCard(index);
                }

                cardStack.appendChild(cardEl);
            }

            progress.textContent = `Progress: ${currentIndex}/${cards.length}`;
        }

        function flipCard(index) {
            if (flippedCards.has(index)) {
                flippedCards.delete(index);
            } else {
                flippedCards.add(index);
            }
            render();
        }

        function nextCard() {
            if (currentIndex < cards.length - 1) {
                currentIndex++;
                render();
            }
        }

        function prevCard() {
            if (currentIndex > 0) {
                currentIndex--;
                render();
            }
        }

        function shuffleCards() {
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            currentIndex = 0;
            flippedCards.clear();
            render();
        }

        function resetDeck() {
            currentIndex = 0;
            flippedCards.clear();
            render();
        }

        function deleteCard(index) {
            if (confirm('Are you sure you want to delete this card?')) {
                cards.splice(index, 1);
                if (currentIndex >= cards.length && currentIndex > 0) {
                    currentIndex--;
                }
                flippedCards.delete(index);
                render();
            }
        }

        function editCard(index) {
            const card = cards[index];
            document.getElementById('frontInput').value = card.front;
            document.getElementById('backInput').value = card.back;
            
            // Store editing index
            window.editingIndex = index;
            document.getElementById('addModal').classList.add('active');
            document.querySelector('.modal-header').textContent = 'Edit Card';
        }

        function openAddModal() {
            window.editingIndex = null;
            document.getElementById('frontInput').value = '';
            document.getElementById('backInput').value = '';
            document.getElementById('addModal').classList.add('active');
            document.querySelector('.modal-header').textContent = 'Create New Card';
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
            window.editingIndex = null;
        }

        function addCard() {
            const front = document.getElementById('frontInput').value.trim();
            const back = document.getElementById('backInput').value.trim();

            if (!front || !back) {
                alert('Please fill in both sides of the card');
                return;
            }

            if (window.editingIndex !== null) {
                // Edit existing card
                cards[window.editingIndex] = { front, back };
            } else {
                // Add new card
                cards.push({ front, back });
            }

            closeAddModal();
            render();
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('addModal').classList.contains('active')) return;

            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                if (flippedCards.has(currentIndex)) {
                    nextCard();
                } else {
                    flipCard(currentIndex);
                }
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevCard();
            }
        });

        // Close modal on outside click
        document.getElementById('addModal').addEventListener('click', (e) => {
            if (e.target.id === 'addModal') {
                closeAddModal();
            }
        });

        // AI Quiz functionality
        let quizConversation = [];
        let currentQuizCard = null;

        function openAIQuizModal() {
            if (cards.length === 0) {
                alert('Please add some cards first before starting the AI quiz!');
                return;
            }
            document.getElementById('aiQuizModal').classList.add('active');
            document.getElementById('aiQuizContent').style.display = 'block';
            document.getElementById('aiConversation').style.display = 'none';
            quizConversation = [];
        }

        function closeAIQuizModal() {
            document.getElementById('aiQuizModal').classList.remove('active');
        }

        function startAIQuiz() {
            document.getElementById('aiQuizContent').style.display = 'none';
            document.getElementById('aiConversation').style.display = 'block';
            getNewQuestion();
        }

        async function getNewQuestion() {
            // Pick a random card
            currentQuizCard = cards[Math.floor(Math.random() * cards.length)];
            
            // Show loading
            addChatMessage('ai', 'Preparing a question<span class="loading-dots"></span>');

            try {
                // Create context from all cards
                const cardContext = cards.map((card, idx) => 
                    `Card ${idx + 1}:\nFront: ${card.front}\nBack: ${card.back}`
                ).join('\n\n');

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [
                            {
                                role: 'user',
                                content: `You are a helpful tutor helping someone study their cue cards. Here are all their cards:\n\n${cardContext}\n\nBased on these cards, ask me ONE creative study question. You can:\n- Ask the question in a different way than it appears on the card\n- Ask me to apply the concept\n- Test related understanding\n- Make it multiple choice\n- Ask me to explain in my own words\n\nKeep it focused on the card content. Be encouraging and helpful!`
                            }
                        ]
                    })
                });

                const data = await response.json();
                const question = data.content.find(item => item.type === 'text')?.text || 'Could you tell me about one of the topics from your cards?';
                
                // Remove loading and add actual question
                removeLastChatMessage();
                addChatMessage('ai', question);
                
            } catch (error) {
                console.error('Error getting question:', error);
                removeLastChatMessage();
                addChatMessage('ai', "Let me ask you about: " + currentQuizCard.front);
            }

            // Clear input
            document.getElementById('userAnswer').value = '';
            document.getElementById('userAnswer').focus();
        }

        async function submitAnswer() {
            const userAnswer = document.getElementById('userAnswer').value.trim();
            if (!userAnswer) return;

            // Add user message
            addChatMessage('user', userAnswer);
            document.getElementById('userAnswer').value = '';

            // Show loading
            addChatMessage('ai', 'Thinking<span class="loading-dots"></span>');

            try {
                // Build conversation history
                const conversationHistory = quizConversation.map(msg => ({
                    role: msg.role,
                    content: msg.content
                }));

                // Create context from all cards
                const cardContext = cards.map((card, idx) => 
                    `Card ${idx + 1}:\nFront: ${card.front}\nBack: ${card.back}`
                ).join('\n\n');

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [
                            {
                                role: 'user',
                                content: `You are a helpful tutor. Here are the study cards:\n\n${cardContext}\n\nYou asked me a question and I answered. Please give me helpful feedback on my answer. Be encouraging! If my answer is correct or close, praise me. If it needs work, gently guide me. Keep responses concise (2-3 sentences).`
                            },
                            ...conversationHistory.slice(-6), // Keep last 3 exchanges
                            {
                                role: 'user',
                                content: userAnswer
                            }
                        ]
                    })
                });

                const data = await response.json();
                const feedback = data.content.find(item => item.type === 'text')?.text || 'Good effort! Keep studying!';
                
                // Remove loading and add feedback
                removeLastChatMessage();
                addChatMessage('ai', feedback);
                
            } catch (error) {
                console.error('Error getting feedback:', error);
                removeLastChatMessage();
                addChatMessage('ai', 'Great job sharing your thoughts! Want to try another question?');
            }
        }

        function addChatMessage(role, content) {
            const chatHistory = document.getElementById('chatHistory');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            messageDiv.innerHTML = `
                <div class="chat-message-label">${role === 'ai' ? 'ü§ñ AI Tutor' : 'üë§ You'}</div>
                <div class="chat-message-text">${content}</div>
            `;
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;

            // Store in conversation history (without HTML)
            quizConversation.push({
                role: role === 'ai' ? 'assistant' : 'user',
                content: content.replace(/<[^>]*>/g, '') // Strip HTML tags for API
            });
        }

        function removeLastChatMessage() {
            const chatHistory = document.getElementById('chatHistory');
            if (chatHistory.lastChild) {
                chatHistory.removeChild(chatHistory.lastChild);
            }
            if (quizConversation.length > 0) {
                quizConversation.pop();
            }
        }

        // Enter key to submit answer
        document.getElementById('userAnswer').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                submitAnswer();
            }
        });

        // Initial render
        render();
    </script>
</body>
</html>
